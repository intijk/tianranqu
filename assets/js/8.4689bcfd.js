(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{372:function(t,s,a){t.exports=a.p+"assets/img/1.8.redandgreen.b93ee6a1.png"},373:function(t,s,a){t.exports=a.p+"assets/img/1.8.green.8782ad09.png"},374:function(t,s,a){t.exports=a.p+"assets/img/1.8.greater.b93ee6a1.png"},407:function(t,s,a){"use strict";a.r(s);var n=a(10),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"_1-8-坐标系统"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-8-坐标系统"}},[t._v("#")]),t._v(" 1.8.坐标系统")]),t._v(" "),n("p",[n("span",{staticClass:"katex-display"},[n("span",{staticClass:"katex"},[n("span",{staticClass:"katex-mathml"},[n("math",[n("semantics",[n("mrow",[n("msub",[n("mi",[t._v("V")]),n("mrow",[n("mi",[t._v("c")]),n("mi",[t._v("l")]),n("mi",[t._v("i")]),n("mi",[t._v("p")])],1)],1),n("mo",[t._v("=")]),n("msub",[n("mi",[t._v("M")]),n("mrow",[n("mi",[t._v("p")]),n("mi",[t._v("r")]),n("mi",[t._v("o")]),n("mi",[t._v("j")]),n("mi",[t._v("e")]),n("mi",[t._v("c")]),n("mi",[t._v("t")]),n("mi",[t._v("i")]),n("mi",[t._v("o")]),n("mi",[t._v("n")])],1)],1),n("mo",[t._v("⋅")]),n("msub",[n("mi",[t._v("M")]),n("mrow",[n("mi",[t._v("v")]),n("mi",[t._v("i")]),n("mi",[t._v("e")]),n("mi",[t._v("w")])],1)],1),n("mo",[t._v("⋅")]),n("msub",[n("mi",[t._v("M")]),n("mrow",[n("mi",[t._v("m")]),n("mi",[t._v("o")]),n("mi",[t._v("d")]),n("mi",[t._v("e")]),n("mi",[t._v("l")])],1)],1),n("mo",[t._v("⋅")]),n("msub",[n("mi",[t._v("V")]),n("mrow",[n("mi",[t._v("l")]),n("mi",[t._v("o")]),n("mi",[t._v("c")]),n("mi",[t._v("a")]),n("mi",[t._v("l")])],1)],1)],1),n("annotation",{attrs:{encoding:"application/x-tex"}},[t._v("V_{clip} = M_{projection} \\cdot M_{view} \\cdot M_{model} \\cdot V_{local}\n")])],1)],1)],1),n("span",{staticClass:"katex-html",attrs:{"aria-hidden":"true"}},[n("span",{staticClass:"strut",staticStyle:{height:"0.68333em"}}),n("span",{staticClass:"strut bottom",staticStyle:{height:"0.969438em","vertical-align":"-0.286108em"}}),n("span",{staticClass:"base displaystyle textstyle uncramped"},[n("span",{staticClass:"mord"},[n("span",{staticClass:"mord mathit",staticStyle:{"margin-right":"0.22222em"}},[t._v("V")]),n("span",{staticClass:"vlist"},[n("span",{staticStyle:{top:"0.15em","margin-right":"0.05em","margin-left":"-0.22222em"}},[n("span",{staticClass:"fontsize-ensurer reset-size5 size5"},[n("span",{staticStyle:{"font-size":"0em"}},[t._v("​")])]),n("span",{staticClass:"reset-textstyle scriptstyle cramped"},[n("span",{staticClass:"mord scriptstyle cramped"},[n("span",{staticClass:"mord mathit"},[t._v("c")]),n("span",{staticClass:"mord mathit",staticStyle:{"margin-right":"0.01968em"}},[t._v("l")]),n("span",{staticClass:"mord mathit"},[t._v("i")]),n("span",{staticClass:"mord mathit"},[t._v("p")])])])]),n("span",{staticClass:"baseline-fix"},[n("span",{staticClass:"fontsize-ensurer reset-size5 size5"},[n("span",{staticStyle:{"font-size":"0em"}},[t._v("​")])]),t._v("​")])])]),n("span",{staticClass:"mrel"},[t._v("=")]),n("span",{staticClass:"mord"},[n("span",{staticClass:"mord mathit",staticStyle:{"margin-right":"0.10903em"}},[t._v("M")]),n("span",{staticClass:"vlist"},[n("span",{staticStyle:{top:"0.15em","margin-right":"0.05em","margin-left":"-0.10903em"}},[n("span",{staticClass:"fontsize-ensurer reset-size5 size5"},[n("span",{staticStyle:{"font-size":"0em"}},[t._v("​")])]),n("span",{staticClass:"reset-textstyle scriptstyle cramped"},[n("span",{staticClass:"mord scriptstyle cramped"},[n("span",{staticClass:"mord mathit"},[t._v("p")]),n("span",{staticClass:"mord mathit",staticStyle:{"margin-right":"0.02778em"}},[t._v("r")]),n("span",{staticClass:"mord mathit"},[t._v("o")]),n("span",{staticClass:"mord mathit",staticStyle:{"margin-right":"0.05724em"}},[t._v("j")]),n("span",{staticClass:"mord mathit"},[t._v("e")]),n("span",{staticClass:"mord mathit"},[t._v("c")]),n("span",{staticClass:"mord mathit"},[t._v("t")]),n("span",{staticClass:"mord mathit"},[t._v("i")]),n("span",{staticClass:"mord mathit"},[t._v("o")]),n("span",{staticClass:"mord mathit"},[t._v("n")])])])]),n("span",{staticClass:"baseline-fix"},[n("span",{staticClass:"fontsize-ensurer reset-size5 size5"},[n("span",{staticStyle:{"font-size":"0em"}},[t._v("​")])]),t._v("​")])])]),n("span",{staticClass:"mbin"},[t._v("⋅")]),n("span",{staticClass:"mord"},[n("span",{staticClass:"mord mathit",staticStyle:{"margin-right":"0.10903em"}},[t._v("M")]),n("span",{staticClass:"vlist"},[n("span",{staticStyle:{top:"0.15em","margin-right":"0.05em","margin-left":"-0.10903em"}},[n("span",{staticClass:"fontsize-ensurer reset-size5 size5"},[n("span",{staticStyle:{"font-size":"0em"}},[t._v("​")])]),n("span",{staticClass:"reset-textstyle scriptstyle cramped"},[n("span",{staticClass:"mord scriptstyle cramped"},[n("span",{staticClass:"mord mathit",staticStyle:{"margin-right":"0.03588em"}},[t._v("v")]),n("span",{staticClass:"mord mathit"},[t._v("i")]),n("span",{staticClass:"mord mathit"},[t._v("e")]),n("span",{staticClass:"mord mathit",staticStyle:{"margin-right":"0.02691em"}},[t._v("w")])])])]),n("span",{staticClass:"baseline-fix"},[n("span",{staticClass:"fontsize-ensurer reset-size5 size5"},[n("span",{staticStyle:{"font-size":"0em"}},[t._v("​")])]),t._v("​")])])]),n("span",{staticClass:"mbin"},[t._v("⋅")]),n("span",{staticClass:"mord"},[n("span",{staticClass:"mord mathit",staticStyle:{"margin-right":"0.10903em"}},[t._v("M")]),n("span",{staticClass:"vlist"},[n("span",{staticStyle:{top:"0.15em","margin-right":"0.05em","margin-left":"-0.10903em"}},[n("span",{staticClass:"fontsize-ensurer reset-size5 size5"},[n("span",{staticStyle:{"font-size":"0em"}},[t._v("​")])]),n("span",{staticClass:"reset-textstyle scriptstyle cramped"},[n("span",{staticClass:"mord scriptstyle cramped"},[n("span",{staticClass:"mord mathit"},[t._v("m")]),n("span",{staticClass:"mord mathit"},[t._v("o")]),n("span",{staticClass:"mord mathit"},[t._v("d")]),n("span",{staticClass:"mord mathit"},[t._v("e")]),n("span",{staticClass:"mord mathit",staticStyle:{"margin-right":"0.01968em"}},[t._v("l")])])])]),n("span",{staticClass:"baseline-fix"},[n("span",{staticClass:"fontsize-ensurer reset-size5 size5"},[n("span",{staticStyle:{"font-size":"0em"}},[t._v("​")])]),t._v("​")])])]),n("span",{staticClass:"mbin"},[t._v("⋅")]),n("span",{staticClass:"mord"},[n("span",{staticClass:"mord mathit",staticStyle:{"margin-right":"0.22222em"}},[t._v("V")]),n("span",{staticClass:"vlist"},[n("span",{staticStyle:{top:"0.15em","margin-right":"0.05em","margin-left":"-0.22222em"}},[n("span",{staticClass:"fontsize-ensurer reset-size5 size5"},[n("span",{staticStyle:{"font-size":"0em"}},[t._v("​")])]),n("span",{staticClass:"reset-textstyle scriptstyle cramped"},[n("span",{staticClass:"mord scriptstyle cramped"},[n("span",{staticClass:"mord mathit",staticStyle:{"margin-right":"0.01968em"}},[t._v("l")]),n("span",{staticClass:"mord mathit"},[t._v("o")]),n("span",{staticClass:"mord mathit"},[t._v("c")]),n("span",{staticClass:"mord mathit"},[t._v("a")]),n("span",{staticClass:"mord mathit",staticStyle:{"margin-right":"0.01968em"}},[t._v("l")])])])]),n("span",{staticClass:"baseline-fix"},[n("span",{staticClass:"fontsize-ensurer reset-size5 size5"},[n("span",{staticStyle:{"font-size":"0em"}},[t._v("​")])]),t._v("​")])])])])])])])]),t._v(" "),n("p",[n("span",{staticClass:"katex"},[n("span",{staticClass:"katex-mathml"},[n("math",[n("semantics",[n("mrow",[n("msub",[n("mi",[t._v("V")]),n("mrow",[n("mi",[t._v("l")]),n("mi",[t._v("o")]),n("mi",[t._v("c")]),n("mi",[t._v("a")]),n("mi",[t._v("l")])],1)],1)],1),n("annotation",{attrs:{encoding:"application/x-tex"}},[t._v("V_{local}")])],1)],1)],1),n("span",{staticClass:"katex-html",attrs:{"aria-hidden":"true"}},[n("span",{staticClass:"strut",staticStyle:{height:"0.68333em"}}),n("span",{staticClass:"strut bottom",staticStyle:{height:"0.83333em","vertical-align":"-0.15em"}}),n("span",{staticClass:"base textstyle uncramped"},[n("span",{staticClass:"mord"},[n("span",{staticClass:"mord mathit",staticStyle:{"margin-right":"0.22222em"}},[t._v("V")]),n("span",{staticClass:"vlist"},[n("span",{staticStyle:{top:"0.15em","margin-right":"0.05em","margin-left":"-0.22222em"}},[n("span",{staticClass:"fontsize-ensurer reset-size5 size5"},[n("span",{staticStyle:{"font-size":"0em"}},[t._v("​")])]),n("span",{staticClass:"reset-textstyle scriptstyle cramped"},[n("span",{staticClass:"mord scriptstyle cramped"},[n("span",{staticClass:"mord mathit",staticStyle:{"margin-right":"0.01968em"}},[t._v("l")]),n("span",{staticClass:"mord mathit"},[t._v("o")]),n("span",{staticClass:"mord mathit"},[t._v("c")]),n("span",{staticClass:"mord mathit"},[t._v("a")]),n("span",{staticClass:"mord mathit",staticStyle:{"margin-right":"0.01968em"}},[t._v("l")])])])]),n("span",{staticClass:"baseline-fix"},[n("span",{staticClass:"fontsize-ensurer reset-size5 size5"},[n("span",{staticStyle:{"font-size":"0em"}},[t._v("​")])]),t._v("​")])])])])])]),t._v(" 是local vertex, "),n("span",{staticClass:"katex"},[n("span",{staticClass:"katex-mathml"},[n("math",[n("semantics",[n("mrow",[n("msub",[n("mi",[t._v("M")]),n("mrow",[n("mi",[t._v("m")]),n("mi",[t._v("o")]),n("mi",[t._v("d")]),n("mi",[t._v("e")]),n("mi",[t._v("l")])],1)],1)],1),n("annotation",{attrs:{encoding:"application/x-tex"}},[t._v("M_{model}")])],1)],1)],1),n("span",{staticClass:"katex-html",attrs:{"aria-hidden":"true"}},[n("span",{staticClass:"strut",staticStyle:{height:"0.68333em"}}),n("span",{staticClass:"strut bottom",staticStyle:{height:"0.83333em","vertical-align":"-0.15em"}}),n("span",{staticClass:"base textstyle uncramped"},[n("span",{staticClass:"mord"},[n("span",{staticClass:"mord mathit",staticStyle:{"margin-right":"0.10903em"}},[t._v("M")]),n("span",{staticClass:"vlist"},[n("span",{staticStyle:{top:"0.15em","margin-right":"0.05em","margin-left":"-0.10903em"}},[n("span",{staticClass:"fontsize-ensurer reset-size5 size5"},[n("span",{staticStyle:{"font-size":"0em"}},[t._v("​")])]),n("span",{staticClass:"reset-textstyle scriptstyle cramped"},[n("span",{staticClass:"mord scriptstyle cramped"},[n("span",{staticClass:"mord mathit"},[t._v("m")]),n("span",{staticClass:"mord mathit"},[t._v("o")]),n("span",{staticClass:"mord mathit"},[t._v("d")]),n("span",{staticClass:"mord mathit"},[t._v("e")]),n("span",{staticClass:"mord mathit",staticStyle:{"margin-right":"0.01968em"}},[t._v("l")])])])]),n("span",{staticClass:"baseline-fix"},[n("span",{staticClass:"fontsize-ensurer reset-size5 size5"},[n("span",{staticStyle:{"font-size":"0em"}},[t._v("​")])]),t._v("​")])])])])])]),t._v("是local物体在世界坐标系中的坐标，"),n("span",{staticClass:"katex"},[n("span",{staticClass:"katex-mathml"},[n("math",[n("semantics",[n("mrow",[n("msub",[n("mi",[t._v("M")]),n("mrow",[n("mi",[t._v("v")]),n("mi",[t._v("i")]),n("mi",[t._v("e")]),n("mi",[t._v("w")])],1)],1)],1),n("annotation",{attrs:{encoding:"application/x-tex"}},[t._v("M_{view}")])],1)],1)],1),n("span",{staticClass:"katex-html",attrs:{"aria-hidden":"true"}},[n("span",{staticClass:"strut",staticStyle:{height:"0.68333em"}}),n("span",{staticClass:"strut bottom",staticStyle:{height:"0.83333em","vertical-align":"-0.15em"}}),n("span",{staticClass:"base textstyle uncramped"},[n("span",{staticClass:"mord"},[n("span",{staticClass:"mord mathit",staticStyle:{"margin-right":"0.10903em"}},[t._v("M")]),n("span",{staticClass:"vlist"},[n("span",{staticStyle:{top:"0.15em","margin-right":"0.05em","margin-left":"-0.10903em"}},[n("span",{staticClass:"fontsize-ensurer reset-size5 size5"},[n("span",{staticStyle:{"font-size":"0em"}},[t._v("​")])]),n("span",{staticClass:"reset-textstyle scriptstyle cramped"},[n("span",{staticClass:"mord scriptstyle cramped"},[n("span",{staticClass:"mord mathit",staticStyle:{"margin-right":"0.03588em"}},[t._v("v")]),n("span",{staticClass:"mord mathit"},[t._v("i")]),n("span",{staticClass:"mord mathit"},[t._v("e")]),n("span",{staticClass:"mord mathit",staticStyle:{"margin-right":"0.02691em"}},[t._v("w")])])])]),n("span",{staticClass:"baseline-fix"},[n("span",{staticClass:"fontsize-ensurer reset-size5 size5"},[n("span",{staticStyle:{"font-size":"0em"}},[t._v("​")])]),t._v("​")])])])])])]),t._v("是摄影机在世界坐标系中的坐标，"),n("span",{staticClass:"katex"},[n("span",{staticClass:"katex-mathml"},[n("math",[n("semantics",[n("mrow",[n("msub",[n("mi",[t._v("M")]),n("mrow",[n("mi",[t._v("p")]),n("mi",[t._v("r")]),n("mi",[t._v("o")]),n("mi",[t._v("j")]),n("mi",[t._v("e")]),n("mi",[t._v("c")]),n("mi",[t._v("t")]),n("mi",[t._v("i")]),n("mi",[t._v("o")]),n("mi",[t._v("n")])],1)],1)],1),n("annotation",{attrs:{encoding:"application/x-tex"}},[t._v("M_{projection}")])],1)],1)],1),n("span",{staticClass:"katex-html",attrs:{"aria-hidden":"true"}},[n("span",{staticClass:"strut",staticStyle:{height:"0.68333em"}}),n("span",{staticClass:"strut bottom",staticStyle:{height:"0.969438em","vertical-align":"-0.286108em"}}),n("span",{staticClass:"base textstyle uncramped"},[n("span",{staticClass:"mord"},[n("span",{staticClass:"mord mathit",staticStyle:{"margin-right":"0.10903em"}},[t._v("M")]),n("span",{staticClass:"vlist"},[n("span",{staticStyle:{top:"0.15em","margin-right":"0.05em","margin-left":"-0.10903em"}},[n("span",{staticClass:"fontsize-ensurer reset-size5 size5"},[n("span",{staticStyle:{"font-size":"0em"}},[t._v("​")])]),n("span",{staticClass:"reset-textstyle scriptstyle cramped"},[n("span",{staticClass:"mord scriptstyle cramped"},[n("span",{staticClass:"mord mathit"},[t._v("p")]),n("span",{staticClass:"mord mathit",staticStyle:{"margin-right":"0.02778em"}},[t._v("r")]),n("span",{staticClass:"mord mathit"},[t._v("o")]),n("span",{staticClass:"mord mathit",staticStyle:{"margin-right":"0.05724em"}},[t._v("j")]),n("span",{staticClass:"mord mathit"},[t._v("e")]),n("span",{staticClass:"mord mathit"},[t._v("c")]),n("span",{staticClass:"mord mathit"},[t._v("t")]),n("span",{staticClass:"mord mathit"},[t._v("i")]),n("span",{staticClass:"mord mathit"},[t._v("o")]),n("span",{staticClass:"mord mathit"},[t._v("n")])])])]),n("span",{staticClass:"baseline-fix"},[n("span",{staticClass:"fontsize-ensurer reset-size5 size5"},[n("span",{staticStyle:{"font-size":"0em"}},[t._v("​")])]),t._v("​")])])])])])]),t._v("是透视的参数，包括fov等设定。")]),t._v(" "),n("p",[t._v("计算机实际调用draw命令的时候，其实已经变换好了到标准化设备坐标，坐标都要变到[-1,-1,-1] [1,1,1]的三维空间体中。所有的这些变换，都是把坐标转换成标准化设备坐标的过程。")]),t._v(" "),n("p",[t._v("OpenGL会做w分量的除法，得到二维设备坐标并且进行光栅化等操作。Shader编程的目的就是到标准化设备坐标这一步。")]),t._v(" "),n("p",[t._v("view矩阵应该有7个自由度才对呀，3个自由度表示观察的位置，3个自由度表示观察的方向，1个自由度控制观察的宣传方向（上向量）。为什么在样例程序里没有提及呢？是不是默认了观察-z方向并且用+y作为上向量？")]),t._v(" "),n("p",[t._v("还有如何把gl_Position这个最终的标准化设备坐标的结果输出来呢？想观察一下最后绘制的时候，到底是绘制了什么样的坐标。网上推荐的方法都是用颜色进行输出.")]),t._v(" "),n("p",[t._v("numpy 的矩阵乘法是np.matmul")]),t._v(" "),n("p",[t._v("打印glm的矩阵, 注意，打印出来的矩阵不是行主序的，如果要贴到numpy里计算，要转置一下。")]),t._v(" "),n("div",{staticClass:"language-cpp extra-class"},[n("pre",{pre:!0,attrs:{class:"language-cpp"}},[n("code",[n("span",{pre:!0,attrs:{class:"token macro property"}},[n("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),n("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("define")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token expression"}},[t._v("GLM_ENABLE_EXPERIMENTAL")])]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token macro property"}},[n("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),n("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("include")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("<glm/gtx/string_cast.hpp>")])]),t._v("\n\nstd"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("cout"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v("glm"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("to_string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mat4"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v("std"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("endl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[t._v("OpenGL默认的是ortho view [-1,-1,-1] 到 [1,1,1] 的一个长宽高为2的cube空间，对物体进行world model的变换，只要超出了这个范围，就都无法显示了。")]),t._v(" "),n("p",[t._v("在创建ortho proj矩阵的时候，设置frustrum的近和远，本质上是构造一个矩阵，把远了的拉进来，那么如何把远了的坐标拉进来[-1,-1,-1],[1,1,1]呢？")]),t._v(" "),n("p",[t._v("创建的perspective proj矩阵是可以把物体拉进来的，但是ortho的不行。。。比如  [0.5,0.5,-3,1], 我期望得到一个[0.5,0.5,0,1],但是没得到。经评论提醒，ortho矩阵给的参数不对，正确的应该用标准化设备坐标，[-1,-1], [1,1],而不是光栅化以后的坐标(800,600)，如果用了800,600就太小了，看不到。")]),t._v(" "),n("div",{staticClass:"language-cpp extra-class"},[n("pre",{pre:!0,attrs:{class:"language-cpp"}},[n("code",[t._v("projection "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" glm"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ortho")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.0f")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.0f")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.0f")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.0f")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.1f")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("100.0f")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("才能正常显示\n")])])]),n("p",[t._v("所有的点一定会保留深度，如果不保留深度，遮挡检测就没有办法做了。")]),t._v(" "),n("p",[t._v("一个点在经过一系列变换之后的数值和含义：")]),t._v(" "),n("p",[t._v("初始点位置，在x=0.5, y=0.5, z=0处")]),t._v(" "),n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[t._v("array"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.5")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.5")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("p",[t._v("假设此点位于某物体上，现在这个物体摆放在世界坐标的时候，沿世界坐标的x轴旋转了-55度，假设它像一张照片，那么照片上面向里走，照片下面向外走。")]),t._v(" "),n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[t._v("array"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.5")]),t._v("     "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.286788")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.409576")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("p",[t._v("观察位置处于z=3的位置，所以这里做了一个等效，让物体沿着z轴移动了-3个单位，往屏幕深处走。")]),t._v(" "),n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[t._v("array"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.5")]),t._v("     "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.286788")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3.409576")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("p",[t._v("最后做了一个投影矩阵，fov是45度，近0.1f，远100f的frustrum")]),t._v(" "),n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[t._v("array"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.2071065")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.69236732")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3.21620197")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3.409576")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("p",[t._v("再除以w分量之后得到如下结果, 所以这个点一定会被绘制到标准化坐标的(0.354, 0.203)位置上，而0.943则会被用来做深度检测。")]),t._v(" "),n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[t._v("array"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.3540342")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.20306552")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.94328502")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("p",[t._v("如果我们不用perspective ，投影矩阵用一个ortho")]),t._v(" "),n("div",{staticClass:"language-cpp extra-class"},[n("pre",{pre:!0,attrs:{class:"language-cpp"}},[n("code",[t._v("projection "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" glm"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ortho")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.0f")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.0f")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.0f")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.0f")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.1f")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("100.0f")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("才能正常显示\n")])])]),n("p",[t._v("那么投影之后得到的坐标是:")]),t._v(" "),n("div",{staticClass:"language-cpp extra-class"},[n("pre",{pre:!0,attrs:{class:"language-cpp"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("array")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.5")]),t._v("       "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.286788")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.95132175")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.")]),t._v("        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("p",[t._v("比较应用ortho之前的点坐标，只是对z坐标的深度进行了frustrum范围内的缩放，并没有改变 x和y的坐标。")]),t._v(" "),n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[t._v("array"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.5")]),t._v("     "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.286788")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3.409576")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  \n")])])]),n("p",[t._v("我用了一个远到100单位之外坐标，用透视投影，发现坐标刚刚落在1上：")]),t._v(" "),n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" a"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.5")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.5")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" b"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("np"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("matmul"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("proj"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" a"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" b\narray"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.2071065")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.2071065")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("       "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("       "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" b"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("\narray"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.01207107")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.01207107")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("p",[t._v("如果稍微远一点")]),t._v(" "),n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" a"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.5")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.5")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("101")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" b"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("np"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("matmul"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("proj"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" a"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" b\narray"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.2071065")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.2071065")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("101.002002")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("101")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("       "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" b"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("101")]),t._v("\narray"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.01195155")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.01195155")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.00001982")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("p",[t._v("那么这个点就出了标准化坐标的cube2  （1.00001982)，这个自然就被剔除掉不显示了, 无穷远也是一样的，得到的z会比1大，跑出cube2,然后就被剔除了。")]),t._v(" "),n("p",[t._v("对于ortho的投影来说是一样的, 当距离跑出frustrum的定义的时候，z得到的跑出cube2,被剔除。")]),t._v(" "),n("div",{staticClass:"language-python extra-class"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" b"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("np"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("matmul"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ortho"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" a"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" b\narray"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.5")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.5")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.0202")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" a\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.5")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.5")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("101")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),n("p",[t._v("另外还注意到一个现象，投影之后算出来的z值，和原来的关系是反的，原来越小，距离越远，但是求出来越大，往正的走了。所以做深度检测的时候，值小的反倒把大的挡住了，而不是按世界坐标那样值大的挡住值小的。")]),t._v(" "),n("p",[t._v("如果沿x旋转一下，然后上面跑出cube2,下面还在里面会怎么办呢？只显示这张照片的一部分？还是都不显示？")]),t._v(" "),n("p",[t._v("打开深度检测，按世界坐标的逻辑画两个图，开启深度检测，应该是错的？(做完下面的实验回来回答下，是的，默认的深度检测函数是GL_LESS)\n首先我测试了一下，如果不打开深度测试，那么就是后绘制的三角形会覆盖先绘制的三角形。\n打开深度测试之后。。。什么都看不到了。。。。\n看不到的原因是"),n("a",{attrs:{href:"https://stackoverflow.com/questions/15333409/enabling-depth-test-causes-nothing-at-all-to-appear",target:"_blank",rel:"noopener noreferrer"}},[t._v("这个"),n("OutboundLink")],1),t._v("\n在"),n("code",[t._v("glEnable(GL_DEPTH_TEST)")]),t._v("之后，渲染之前，需要调用"),n("code",[t._v("glClear(GL_DEPTH_BUFFER_BIT)")]),t._v(" 我放在了渲染之后，就不行了.")]),t._v(" "),n("p",[t._v("depth test 可以选择用哪个比较函数，投影之后，据我上面的分析，应该是小值被显示，但是用DepthFunc是可以控制这些行为的。")]),t._v(" "),n("div",{staticClass:"language-cpp extra-class"},[n("pre",{pre:!0,attrs:{class:"language-cpp"}},[n("code",[t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("glDepthFunc")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("GLenum func​"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[t._v("我的点是这样的")]),t._v(" "),n("div",{staticClass:"language-cpp extra-class"},[n("pre",{pre:!0,attrs:{class:"language-cpp"}},[n("code",[t._v("    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("float")]),t._v(" vertices"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// positions         // colors")]),t._v("\n\n         "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.8f")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.5f")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.5f")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0f")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.0f")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0f")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// bottom right")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.8f")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.5f")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.5f")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0f")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.0f")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0f")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// bottom left")]),t._v("\n         "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0f")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.5f")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.5f")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0f")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.0f")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0f")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// top ")]),t._v("\n\n         "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.5f")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.5f")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.5f")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.0f")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0f")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0f")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// bottom right")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.5f")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.5f")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.5f")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.0f")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0f")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0f")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// bottom left")]),t._v("\n         "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0f")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.5f")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.5f")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.0f")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0f")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0f")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// top ")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[t._v("在打开深度测试之前，按照先后顺序，先渲染了绿色的三角形，然后渲染了红色的三角形。")]),t._v(" "),n("p",[n("img",{attrs:{src:a(372),alt:"red and gree"}})]),t._v(" "),n("p",[t._v("但是打开深度测试之后，就只显示了绿色的三角形。")]),t._v(" "),n("p",[n("img",{attrs:{src:a(373),alt:"green"}})]),t._v(" "),n("p",[t._v("按道理，OpenGL用的是右手坐标系，z轴戳瞎你的眼，朝屏幕外的，我绿色的三角形z value是-0.5，红色的三角形z value是0.5，但是打开深度测试之后，发现理论上更朝屏幕外的红色却被挡住了。")]),t._v(" "),n("p",[t._v("原因就是我刚才上面的一番数值分析得到的结论，当经过投影矩阵往规范视域体（canonical view volume,  就是标准化设备坐标的cube2）投影之后，数值越小越靠-1的值离观察点越近，数值越大越靠近+1的值离观察点越远，所以OpenGL的默认深度检测函数其实是小于（我不确定是小于还是小于等于）。这就造成了我们精心画了两个三角形之后，按照直观的z轴标准看，发现反倒是绿的堵住了红的。其实都是因为OpenGL假设你做过投影矩阵了。")]),t._v(" "),n("p",[t._v("当然了，我们也可以手动修改深度检测的函数，我把它改成大于")]),t._v(" "),n("div",{staticClass:"language-cpp extra-class"},[n("pre",{pre:!0,attrs:{class:"language-cpp"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("glDepthFunc")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("GL_GREATER"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("p",[t._v("改成大于之后什么都显示不出了。。。。。")]),t._v(" "),n("p",[t._v("深度测试的本质其实是和一个深度buffer进行比较，比如一开始深度buffer是这样,(以glDepthFunc为GL_GREATER为例）")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("-1 -1 -1\n-1 -1 -1\n-1 -1 -1\n")])])]),n("p",[t._v("我们画了一个方框之后，变成")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("-1 -1 -1\n-1  0  0\n-1  0  0\n")])])]),n("p",[t._v("那么我还想画一个三角形，")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("-1 -1 -1\n-1  0  1\n-1  1  1\n")])])]),n("p",[t._v("这时候如果我还想在左上角画一个-0.5深度的方框，")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("-0.5 -0.5 -1\n-0.5    0  1\n  -1    1  1\n")])])]),n("p",[t._v("因为中间这个点我-0.5>0么，不，检测失败了，所以这个像素就没有画。")]),t._v(" "),n("p",[t._v("是的 OpenGL 的深度检测其实是发生在fragment shader之后的，这时候光栅化都结束了，逐像素的数据都产生了，深度检测就是比一比buffer。但是这里做深度检测未免太晚了一些，所以现在都追求很早阶段的各种奇迹淫巧的深度检测(culling以及其它手段)，争取把计算从源头上就降到最小。")]),t._v(" "),n("p",[t._v("回到上面那个问题，为什么GL_GREATER以后什么都不显示，我觉得这个和"),n("code",[t._v("glClear(GL_DEPTH_BUFFER_BIT)")]),t._v("的实现有关，这个函数应该默认就是把depth buffer的值设成一个极大值，然后做GL_LESS的深度检测的时候，作为背景。但是当你用GL_GREATER做深度检测的时候，这个"),n("code",[t._v("glClear(GL_DEPTH_BUFFER_BIT)")]),t._v("还把buffer值整成一个极大值，那这个背景这时候就盖住了将来你所有想要画的东西，导致什么也画不出来了。")]),t._v(" "),n("p",[t._v("理论上"),n("code",[t._v("glClear(GL_DEPTH_BUFFER_BIT)")]),t._v("应该根据当前的glDepthFunc的值来设置这个背景深度，但是我猜它出于某种原因并没有这么智能。")]),t._v(" "),n("p",[t._v("果然呢，有一个函数叫做glClearDepth的，它和glClear配合使用，虽然ndc的cvv是个cube2,但是glClear的时候只能设置[0,1]，超过的部分会被clamp成[0,1]，问了朋友，说是proj以后的结果，z确实是[-1,1]的，但是和这个depthbuffer做比较的时候，会线性映射到[0,1] (除2移0.5)。")]),t._v(" "),n("p",[t._v("这里我知道了设置")]),t._v(" "),n("div",{staticClass:"language-cpp extra-class"},[n("pre",{pre:!0,attrs:{class:"language-cpp"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("glClearDepth")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("glClear")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("GL_DEPTH_BUFFER_BIT"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[t._v("就成了我需要的GL_GREATER深度检测的背景极小值，这样就得到了我想要的红色画在前面的样子。")]),t._v(" "),n("p",[n("img",{attrs:{src:a(374),alt:"greater"}})])])}),[],!1,null,null,null);s.default=e.exports}}]);